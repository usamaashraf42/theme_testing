{% layout none %}{%- if product.metafields.subscriptions.subscription_id and product.metafields.subscriptions.shipping_interval_frequency -%}{% comment %}Subscriptions Powered by ReCharge Payments: Meta Fields{% endcomment %}{% comment %}Subscription settings{% endcomment %}{% assign subscription_product = product.metafields.subscriptions %}{% assign subscription_id = subscription_product.subscription_id %}{% assign widget_settings = shop.metafields.subscriptions %}{% if widget_settings.subscription_active == "true" %}{% assign subscription_active = true %}{% else %}{% assign subscription_active = false %}{% endif %}{% if subscription_product.is_subscription_only == "true" or product.tags contains "Subscription Only" or product.tags contains "subscription only" or product.tags contains "Subscription only" or product.tags contains "subscriptiononly" %}{% assign subscription_only = true %}{% else %}{% assign subscription_only = false %}{% endif %}{% if widget_settings.select_subscription_first == "true" %}{% assign select_subscription_first = true %}{% else %}{% assign select_subscription_first = false %}{% endif %}{% if subscription_only or select_subscription_first %}{% assign default_purchase_type = "autodeliver" %}{% else %}{% assign default_purchase_type = "onetime" %}{% endif %}{% comment %}Subscription Interval Settings{% endcomment %}{% if subscription_product.shipping_interval_unit_type.size > 0 %}{% assign shipping_interval_unit_type = subscription_product.shipping_interval_unit_type %}{% else %}{% assign shipping_interval_unit_type = "Days" %}{% endif %}{% if shipping_interval_unit_type == "day" %}{% assign shipping_interval_unit_type = "Days" %}{% elsif shipping_interval_unit_type == "week" %}{% assign shipping_interval_unit_type = "Weeks" %}{% elsif shipping_interval_unit_type == "month" %}{% assign shipping_interval_unit_type = "Months" %}{% endif %}{% if subscription_product.shipping_interval_frequency.size > 0 %}{% assign shipping_interval_frequency = subscription_product.shipping_interval_frequency | split: "," %}{% else %}{% assign shipping_interval_frequency = "30" %}{% endif %}{% comment %}Discount settings{% endcomment %}{% assign discount_percentage = subscription_product.discount_percentage | round: 2 %}{% assign discount_floor = subscription_product.discount_percentage | floor %}{% if discount_percentage == discount_floor %}{% assign discount_percentage = discount_floor %}{% endif %}{% comment %}Currency settings{% endcomment %}{% assign currency_prefix = widget_settings.currency_prefix | default: "$" %}{% assign currency_suffix = widget_settings.currency_suffix | default: "" %}{% comment %}Widget translation{% endcomment %}{% assign label_onetime = widget_settings.onetime_message | default: "One-time purchase" %}{% assign label_autodeliver = widget_settings.subscribe_message | default: "Subscribe & save" %}{% assign label_deliver_every = widget_settings.widget_deliver_every | default: "Deliver every" %}{% assign shipping_interval_unit_type_translated = shipping_interval_unit_type %}{% if widget_settings.translations %}{% if shipping_interval_unit_type == "Days" %}{% assign shipping_interval_unit_type_translated = widget_settings.translations["days"] %}{% elsif shipping_interval_unit_type == "Weeks" %}{% assign shipping_interval_unit_type_translated = widget_settings.translations["weeks"] %}{% else %}{% assign shipping_interval_unit_type_translated = widget_settings.translations["months"] %}{% endif %}{% endif %}{% comment %}Popup settings{% endcomment %}{% if widget_settings.show_subscription_details == "false" %}{% assign show_widget = false %}{% else %}{% assign show_widget = true %}{% endif %}{% if widget_settings.show_subscription_details_icon == "false" %}{% assign show_widget_icon = false %}{% else %}{% assign show_widget_icon = true %}{% endif %}{% if widget_settings.show_learnmore == "false" %}{% assign show_learnmore = false %}{% else %}{% assign show_learnmore = true %}{% endif %}{% if widget_settings.show_poweredby == "false" %}{% assign show_poweredby = false %}{% else %}{% assign show_poweredby = true %}{% endif %}{% comment %}Custom text{% endcomment %}{% assign subscription_details_label = widget_settings.subscription_details_verbiage | default: "Subscription details" %}{% assign how_it_works_text = widget_settings.how_it_works | default: "<strong>How subscriptions work</strong><br><br>Products are automatically delivered on your schedule. No obligation, modify or cancel your subscription anytime." %}{% assign learnmore_link = widget_settings.learnmore_verbiage | default: "Learn more..." %}{% comment %}Custom styling{% endcomment %}{% assign widget_label_color = widget_settings.font_color | default: "#000000" %}{% assign widget_active_color = widget_settings.active_color | default: "#676767" %}{% assign widget_active_bg = widget_settings.background_color | default: "#F8F8F8" %}{% assign widget_icon = subscription.widget_icon | default: "black" %}{% if widget_icon == "white" %}{% assign widget_icon = "//rechargestatic-bootstrapheroes.netdna-ssl.com/static/images/widget/rc_widget__icon__white@2x.png" %}{% else %}{% assign widget_icon = "//rechargestatic-bootstrapheroes.netdna-ssl.com/static/images/widget/rc_widget__icon__black@2x.png" %}{% endif %}{% assign popup_zindex = widget_settings.popup_zindex | default: "56" %}{% assign popup_background_color = widget_settings.popup_background_color | default: "#474747" %}{% assign popup_text_color = widget_settings.popup_text_color | default: "#FFFFFF" %}{% assign popup_link_color = widget_settings.popup_link_color | default: "#4DD6B7" %}{% assign recharge_custom_css = widget_settings.custom_css | defalut: "" %}{% comment %}Custom URLs{% endcomment %}{% comment %}Learn more link{% endcomment %}{% if widget_settings.learnmore_url %}{% if widget_settings.learnmore_url contains "rechargepayments.com/subscribe-with-recharge" %}{% capture learnmore_url %}http://rechargepayments.com/subscribe-with-recharge?utm_source=shopify%20store&utm_medium=customer%20link&utm_campaign=Shopify%20store%20back%20link&shop_name={{ shop.name | url_param_escape }}&shop={{ shop.permanent_domain }}{% endcapture %}{% else %}{% assign learnmore_url = widget_settings.learnmore_url %}{% endif %}{% else %}{% capture learnmore_url %}http://rechargepayments.com/subscribe-with-recharge?utm_source=shopify%20store&utm_medium=customer%20link&utm_campaign=Shopify%20store%20back%20link&shop_name={{ shop.name | url_param_escape }}&shop={{ shop.permanent_domain }}{% endcapture %}{% endif %}{% comment %}Powered by badge{% endcomment %}{% if widget_settings.poweredby_url %}{% if widget_settings.poweredby_url contains "rechargepayments.com/subscribe-with-recharge" %}{% capture poweredby_url %}http://rechargepayments.com/subscribe-with-recharge?utm_source=shopify%20store&utm_medium=customer%20link&utm_campaign=Shopify%20store%20back%20link&shop_name={{ shop.name | url_param_escape }}&shop={{ shop.permanent_domain }}{% endcapture %}{% else %}{% assign poweredby_url = widget_settings.poweredby_url %}{% endif %}{% else %}{% capture poweredby_url %}http://rechargepayments.com/subscribe-with-recharge?utm_source=shopify%20store&utm_medium=customer%20link&utm_campaign=Shopify%20store%20back%20link&shop_name={{ shop.name | url_param_escape }}&shop={{ shop.permanent_domain }}{% endcapture %}{% endif %}  {  "id": {{ product.id }},  "label_onetime": "{{ label_onetime }}",  "label_autodeliver": "{{ label_autodeliver }}",  "label_deliver_every": "{{ label_deliver_every }}",  "subscription_only": {{ subscription_only }},  "select_subscription_first": {{ select_subscription_first }},  "shipping_interval_unit_type": "{{ shipping_interval_unit_type }}",  "shipping_interval_unit_type_translated": "{{ shipping_interval_unit_type_translated }}",  "shipping_interval_frequency": [{% for interval in shipping_interval_frequency %}"{{ interval }}"{% unless forloop.last %},{% endunless %}{% endfor %}],  "discount_percentage": {{ discount_percentage }},  "variant_to_duplicate": { {% for variant in product.variants %}"{{ variant.id }}":"{{ variant.metafields.subscriptions.discount_variant_id }}"{% unless forloop.last %},{% endunless %}{% endfor %} },  "variant_to_price": { {% for variant in product.variants %}"{{ variant.id }}":"{{ variant.price | money_without_currency }}"{% unless forloop.last %},{% endunless %}{% endfor %} },  "duplicate_to_price": { {% for variant in product.variants %}"{{ variant.metafields.subscriptions.discount_variant_id }}": "{{ variant.metafields.subscriptions.discount_variant_price }}"{% unless forloop.last %},{% endunless %}{% endfor %} }  }{%- else -%}{}{%- endif -%}